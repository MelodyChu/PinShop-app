{% extends 'base.html' %}
{% block content %}

    <h1>PinShop Results</h1>


  {% for result in results %}
    <div>
      <a href="{{ result['url'] }}"><img src="{{ result['image_url'] }}" style="width:100px;height:200px;">{{ result['name'] }}</a>
      <p>{{ result['price'] }}</p>
      {% if "user_id" in session %}
          {# <button class="save-button" data-listingdata="{{ json.dumps(result) }}" >Save</button> #}
          {# <button class="save-button" data-listingdata="{{ result|tojson|safe }}" >Save</button> #}
          <button class="save-button" data-listingdata="{{ result['id'] }}" >Save</button>
      {% endif %}
    </div>
  {% endfor %}


    
    <script> // try document ready & load the jquery tag in the head
    $('.save-button').click(function (evt) {
        let listingdata = $(this).data("listingdata"); // may need JSON dumps here
        // $(this).html("saved");
        // Given an id on a save-button
        

        let payload = {"listing_data": listingdata} // does passing data always need to be in payload dictionary format?
        // console.log(payload);
        console.log(listingdata); 
        console.log(typeof(listingdata));
        $.get('/get-item-info', payload, get_item_info);

        function get_item_info (response) {
          console.log(response);

          $.ajax({
            url: "/add-bookmark.json", 
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify(response),
            processData: false,
            success: function display_saved(results) { // would payload = requests in this case?
            //give user some visual indication that this has happened
            // $(this).html("Saved"); // need to debug; not working
            //console.log(results);
            console.log("Finished saving ShopStyle API result!");

            }
          });
          // THIS WORKED
          // $('.save-button').html("saved");
          // $(this).html("saved");
        };
        $(this).html("Saved");
})

</script>

{% endblock %}